<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aplikasi Ujian Sosiologi (Mobile)</title>
    <style>
        /* RESET & DASAR */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body, html { width: 100%; height: 100%; background-color: #0b2a3c; font-family: 'Segoe UI', sans-serif; overflow: hidden; }

        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; transition: opacity 0.2s ease; background: #0b2a3c; color: white; overflow: hidden; }
        .hidden { opacity: 0 !important; pointer-events: none !important; visibility: hidden !important; }

        /* LOGIN */
        #loginScreen { flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .login-container { background: rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; text-align: center; width: 80%; max-width: 300px; }
        .token-input { width: 100%; padding: 12px; margin-bottom: 20px; border-radius: 10px; border: none; text-align: center; font-size: 1.1rem; }

        /* FORM SCREEN */
        #formScreen { flex-direction: column; z-index: 50; }
        .iframe-container { flex: 1; width: 100%; background: white; position: relative; }
        iframe { width: 100%; height: 100%; border: none; }

        /* KEYBOARD SYSTEM */
        .v-keyboard-area { background: #111; padding: 10px; border-top: 2px solid #3fa9b0; z-index: 1000; }
        
        /* INPUT BRIDGE: Tempat karakter virtual muncul */
        .input-bridge-container { display: flex; gap: 5px; margin-bottom: 10px; }
        #bridgeInput { 
            flex: 1; background: #222; border: 1px solid #3fa9b0; color: #fff; 
            padding: 10px; border-radius: 5px; font-size: 1rem;
        }
        .btn-copy { background: #ffd166; color: #000; border: none; padding: 0 15px; border-radius: 5px; font-weight: bold; }

        .v-keyboard { display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px; }
        .v-key { 
            background: #333; color: white; padding: 15px 0; border-radius: 5px; 
            text-align: center; font-size: 0.9rem; font-weight: bold; cursor: pointer; user-select: none;
        }
        .v-key:active { background: #3fa9b0; }
        .v-key.wide { grid-column: span 1.5; background: #444; }
        .v-key.space { grid-column: span 4; }

        /* TOMBOL X */
        .btn-close { position: absolute; top: 10px; right: 10px; width: 35px; height: 35px; background: red; color: white; border: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 2000; font-weight: bold; }

        .btn-login { background: #3fa9b0; border: none; padding: 15px; width: 100%; border-radius: 10px; color: #0b2a3c; font-weight: bold; font-size: 1.1rem; }
    </style>
</head>
<body>

    <div id="loginScreen" class="screen">
        <div class="login-container">
            <h2>SOSIOLOGI</h2>
            <p>Masukkan Token</p><br>
            <input type="text" id="tokenInput" class="token-input" placeholder="Token">
            <button id="loginBtn" class="btn-login">MASUK</button>
        </div>
    </div>

    <div id="formScreen" class="screen hidden">
        <div id="btnClose" class="btn-close">âœ•</div>
        
        <div class="iframe-container">
            <iframe id="examIframe" src="https://docs.google.com/forms/d/e/1FAIpQLSc85_F7-3tEVaA24WFICtwOmonjKzRSEt82UcfO1vIx2cjF5Q/viewform?embedded=true"></iframe>
        </div>

        <div class="v-keyboard-area">
            <div class="input-bridge-container">
                <input type="text" id="bridgeInput" placeholder="Ketik jawaban di sini..." readonly inputmode="none">
                <button class="btn-copy" id="btnCopy">SALIN</button>
            </div>
            <div class="v-keyboard">
                <div class="v-key">Q</div><div class="v-key">W</div><div class="v-key">E</div><div class="v-key">R</div><div class="v-key">T</div>
                <div class="v-key">Y</div><div class="v-key">U</div><div class="v-key">I</div><div class="v-key">O</div><div class="v-key">P</div>
                <div class="v-key">A</div><div class="v-key">S</div><div class="v-key">D</div><div class="v-key">F</div><div class="v-key">G</div>
                <div class="v-key">H</div><div class="v-key">J</div><div class="v-key">K</div><div class="v-key">L</div><div class="v-key">?</div>
                <div class="v-key wide" id="keyShift">UP</div>
                <div class="v-key">Z</div><div class="v-key">X</div><div class="v-key">C</div><div class="v-key">V</div><div class="v-key">B</div>
                <div class="v-key">N</div><div class="v-key">M</div>
                <div class="v-key wide" id="keyDel">DEL</div>
                <div class="v-key space" id="keySpace">SPACE</div>
                <div class="v-key wide" style="grid-column: span 3; background: #3fa9b0;" id="keyClear">HAPUS SEMUA</div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            "use strict";

            const loginScreen = document.getElementById('loginScreen');
            const formScreen = document.getElementById('formScreen');
            const tokenInput = document.getElementById('tokenInput');
            const bridgeInput = document.getElementById('bridgeInput');
            const btnLogin = document.getElementById('loginBtn');
            const btnClose = document.getElementById('btnClose');
            const btnCopy = document.getElementById('btnCopy');

            let isLoggedIn = false;
            let securityActive = false;
            let isUpper = true;

            // LOGIKA KEYBOARD VIRTUAL
            document.querySelectorAll('.v-key').forEach(key => {
                key.addEventListener('click', () => {
                    const txt = key.innerText;
                    if (txt === 'DEL') {
                        bridgeInput.value = bridgeInput.value.slice(0, -1);
                    } else if (txt === 'SPACE') {
                        bridgeInput.value += ' ';
                    } else if (txt === 'UP') {
                        isUpper = !isUpper;
                        key.style.background = isUpper ? '#3fa9b0' : '#444';
                    } else if (txt === 'HAPUS SEMUA') {
                        bridgeInput.value = '';
                    } else {
                        bridgeInput.value += isUpper ? txt.toUpperCase() : txt.toLowerCase();
                    }
                });
            });

            // FUNGSI SALIN
            btnCopy.addEventListener('click', () => {
                bridgeInput.select();
                bridgeInput.setSelectionRange(0, 99999);
                navigator.clipboard.writeText(bridgeInput.value);
                btnCopy.innerText = "OK!";
                setTimeout(() => { btnCopy.innerText = "SALIN"; }, 1000);
            });

            // LOGIN & FULLSCREEN
            btnLogin.addEventListener('click', () => {
                if (tokenInput.value === "Sosiologi") {
                    const el = document.documentElement;
                    if (el.requestFullscreen) el.requestFullscreen();
                    else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();

                    loginScreen.classList.add('hidden');
                    formScreen.classList.remove('hidden');
                    isLoggedIn = true;
                    setTimeout(() => { securityActive = true; }, 2000);
                } else {
                    alert("Token Salah!");
                }
            });

            btnClose.addEventListener('click', () => {
                if(confirm("Keluar ke login?")) location.reload();
            });

            // KEAMANAN: Deteksi pindah tab
            document.addEventListener('visibilitychange', () => {
                if (document.hidden && securityActive) {
                    alert("Kecurangan Terdeteksi!");
                    location.reload();
                }
            });

            // Cegah keyboard sistem sebisa mungkin dengan paksa fokus ke body
            window.addEventListener('blur', () => {
                if (isLoggedIn && securityActive) {
                    setTimeout(() => { window.focus(); }, 100);
                }
            });

        })();
    </script>
</body>
</html>
